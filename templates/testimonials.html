<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="static/images/favicon.ico" type="image/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>McVeigh Glazing - Testimonials</title>

    <!-- CSS  -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="static/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
    <link href="static/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body>
<main>
    <div class="navbar-fixed">
        <nav>
            <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons" style="color: yellow">menu</i></a>
            <div class="nav-wrapper blue">
                <a href="#" class="brand-logo">McVeigh Glazing</a>
                <ul class="right hide-on-med-and-down">
                    <li><a href="/">Home</a></li>
                    <li><a href="/gallery">Gallery</a></li>
                    <li><a href="/where">Where?</a></li>
                    <li><a href="#">Testimonials</a></li>
                    <li><a href="/contact">Contact Us</a></li>
                </ul>
                <ul class="side-nav blue darken-4" id="mobile-demo">
                    <li class="center"><a href="/" class="yellow-text">Home</a></li>
                    <li class="center"><a href="/gallery" class="yellow-text">Gallery</a></li>
                    <li class="center"><a href="/where" class="yellow-text">Where?</a></li>
                    <li class="center"><a href="#" class="yellow-text">Testimonials</a></li>
                    <li class="center"><a href="/contact" class="yellow-text">Contact Us</a></li>
                    <div class="container">
                        <div class="row center">
                            <img src="static/images/logo.png" style="width:100%; opacity: 0.7">
                        </div>
                    </div>
                </ul>
            </div>
        </nav>
    </div>

    <div class="container">
        <div class="section">
            <div class="icon-block">
                <h2 class="center brown-text"><i class="material-icons">border_color</i></h2>
                <h5 class="center">Testimonials</h5>
                <p class="light">
                    Here you can read stories from some of our previous customers.
                    <br>
                    <br>
                    Please feel free to leave your own story of our services below, as we would love to hear from you.
                </p>
            </div>
        </div>
        <div class="container">
            <div class="card grey lighten-3">
                <div class="card-content">
                    <h5>Tell Us Your McVeigh Glazing Story</h5>

                    <div class="row">
                        <form id="story-form" action="/submitstory" class="col s12" method="post">
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="name" name="name" class="validate" type="text">
                                    <label for="name">Your Name (Optional)</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <textarea id="story" name="story" class="materialize-textarea" type="text"></textarea>
                                    <label for="story">Your Story</label>
                                </div>
                            </div>
                            <button type="submit" class="btn-large waves-effect waves-light blue lighten-1">Submit Story</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="divider grey"></div>
        {% if admin %}
            <form action="/manage_story" method="post">
                <div class="section">
                    <div class="row flex">
                        <div class="col s12 m4 l6" style="float: left">
                            <button type="submit" name="submit" value="public" class="btn-large waves-effect waves-light green lighten-1" style="width:100%;">Make Selected Public</button>
                        </div>
                        <div class="col s12 m4 l6" style="float: left">
                            <button type="submit" name="submit" value="delete" class="btn-large waves-effect waves-light red lighten-1" style="width:100%;">Delete Selected</button>
                        </div>
                    </div>
                </div>
                {% set count = [0] %}
                {% for story in stories %}
                <div class="section">
                    <div class="row flex">
                        <div class="col s12 m4 l2 blue lighten-2" style="float: left">
                            <h4 class="center black-text"><i class="material-icons">insert_emoticon</i></h4>
                            <p class="center white-text">
                                {% if story[1] == ""%}
                                    Anonymous
                                {% else %}
                                    {{story[1]}}
                                {% endif %}
                                <br>
                                {{story[2]}}
                            </p>
                        </div>
                        <div class="col s12 m4 l8 grey lighten-3" style="word-wrap:break-word; float:left">
                            <p>{{story[3]}}</p>
                        </div>
                        <div class="col s12 m4 l2 blue lighten-2" style="float: left; padding:10px">
                            {% if story[4] == "1" %}
                            <input type="checkbox" class="filled-in center" id="filled-in-box-{{count}}" name="{{count}}" value="true" checked/>
                            {% else %}
                            <input type="checkbox" class="filled-in center" id="filled-in-box-{{count}}" name="{{count}}" value="true"/>
                            {% endif %}
                            <label class="black-text" for="filled-in-box-{{count}}"></label>
                        </div>
                    </div>
                </div>
                {% if count.append(count.pop() + 1) %}{% endif %} {# increment count by 1 #}
                {% endfor %}
            </form>
        {% else %}
            {% for story in stories %}
            <!--public version-->
            <div class="section">
                <div class="row flex">
                    <div class="col s12 m4 l3 blue lighten-2" style="float: left">
                        <h4 class="center black-text"><i class="material-icons">insert_emoticon</i></h4>
                        <p class="center white-text">
                            {{story[1]}}
                            <br>
                            {{story[2]}}
                        </p>
                    </div>
                    <div class="col s12 m4 l9 grey lighten-3" style="word-wrap:break-word; float:left">
                        <p>{{story[3]}}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>
    <div id="story-modal" class="modal">
        <div id="auth-modal-content" class="modal-content">
            <h4>Thank You</h4>
            <p>
                Your McVeigh Glazing story has been submitted for review
            </p>
            <a class="waves-effect waves-light btn blue" href="/testimonials">OK</a>
        </div>
    </div>
</main>

<footer class="page-footer blue">
    <div class="navbar">
        <nav>
            <div class="nav-wrapper blue">
                <ul class="left">
                    <li style="padding-left: 10px">Call 07712877368</li>
                </ul>
            </div>
        </nav>
    </div>
</footer>

<!--  Scripts-->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="static/js/jquery.validate.min.js"></script>
<script src="static/js/materialize.js"></script>
<script src="static/js/init.js"></script>
<script>
    $(document).ready(function(){
        $("#story-form").validate({
            rules: {
                story: {
                    required: true,
                    minlength: 5,
                    maxlength:2000
                }
            },
            messages: {
                story: {
                    required: "Please enter your story",
                    minlength: "Please enter 5 or more characters",
                    maxlength: "Please keep your story less than 2000 characters"
                }
            },
            errorElement : 'div',
            errorPlacement: function(error, element) {
                var placement = $(element).data('error');
                if (placement) {
                    $(placement).append(error)
                } else {
                    error.insertAfter(element);
                }
            }
        });

        if (checkStorySent()) {
            $('.modal').modal({
                    dismissible: false
                }
            );
            $('#story-modal').modal('open');
        }
    });

    function checkStorySent() {
        var field = 'story-sent';
        var url = window.location.href;
        if(url.indexOf('?' + field + '=') != -1)
            return true;
        else if(url.indexOf('&' + field + '=') != -1)
            return true;
        return false
    }
</script>
</body>
</html>
